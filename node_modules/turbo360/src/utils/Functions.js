var Promise = require('bluebird')
var superagent = require('superagent')

var Functions = function(config){
	var _config = config

	var executeFunction = function(params){ 
		return new Promise(function(resolve, reject){
			if (_config.site_id.length < 20){
				reject(new Error('Please Set Your TURBO_APP_ID'))
				return
			}
			
			if (params == null){
				reject(new Error('Post parameters required.'))
				return
			}

			if (params.exec == null){
				reject(new Error('Missing Exec Parameter'))
				return
			}

			params['site'] = _config.site_id

			superagent
			.post(_config.base_url + '/functions')
			.send(parameters)
			.set('Accept', 'application/json')
			.end(function(err, response){
				if (err){
					reject(err)
					return
				}

				var data = response.body
				if (data.confirmation != 'success'){
					reject(new Error(data.message))
					return
				}

				resolve(data)
			})
		})
	}

	var instance = {
		executeFunction: executeFunction
	}

	return instance
}

module.exports = Functions